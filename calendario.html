<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendario - Reparto Maori</title>
  <meta name="description" content="Calendario attivit√† Reparto Maori" />
  <meta name="theme-color" content="#16a34a" />

  <!-- Favicon e icone -->
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json" />

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
</head>

<body class="bg-gray-100 flex flex-col min-h-screen">
  <div id="app" class="max-w-4xl mx-auto w-full bg-white shadow-lg rounded-xl overflow-hidden my-1.5">
    <!-- Header condiviso -->
    <div id="shared-header"></div>

    <!-- Main -->
    <main id="main-content" class="p-6">
      <!-- Modali condivisi -->
      <div id="shared-modals"></div>

      <!-- Contenuto Calendario -->
      <section id="calendarTab" class="tab-content active">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-semibold text-gray-700">Calendario Attivit√†</h2>
          <div class="flex gap-2">
            <button id="exportCalendarICSBtn" class="btn-secondary text-sm px-4 py-2"
              title="Esporta calendario in formato .ics per Google Calendar, Apple Calendar, ecc.">
              üì• Export Calendario
            </button>
          </div>
        </div>



        <!-- Vista Lista (default) -->
        <div id="listCalendarView">
          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
              <h3 class="text-xl font-semibold text-gray-700 mb-4">Aggiungi Nuova Attivit√†</h3>
              <form id="addActivityForm" class="space-y-4">
                <!-- Template attivit√† -->
                <div class="bg-white rounded-lg border border-gray-200 p-3">
                  <div class="flex flex-col gap-2">
                    <div class="flex items-center justify-between gap-2">
                      <div>
                        <label for="activityTemplateSelect" class="block text-sm font-medium text-gray-700">Template
                          attivit√†</label>
                        <p class="text-xs text-gray-500">Seleziona un template per compilare rapidamente i campi</p>
                      </div>
                      <select id="activityTemplateSelect"
                        class="mt-1 px-2 py-1 border border-gray-300 rounded-lg bg-white text-gray-700 text-sm min-w-[160px]">
                        <option value="">Nessun template</option>
                      </select>
                    </div>
                    <div class="flex flex-wrap gap-2 justify-end">
                      <button type="button" id="applyActivityTemplateBtn"
                        class="px-3 py-1 text-sm bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                        Applica template
                      </button>
                      <button type="button" id="saveActivityTemplateBtn"
                        class="px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                        Salva come template
                      </button>
                    </div>
                  </div>
                </div>

                <div>
                  <label for="activityTipo" class="block text-sm font-medium text-gray-700">Tipo</label>
                  <select id="activityTipo" required
                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200">
                    <option value="Riunione">Riunione</option>
                    <option value="Attivit√† lunga">Attivit√† lunga</option>
                    <option value="Uscita">Uscita</option>
                    <option value="Campo">Campo</option>
                    <option value="Evento Adulti">Evento Adulti</option>
                    <option value="Riunione Adulti">Riunione Adulti</option>
                    <option value="Eventi con esterni">Eventi con esterni</option>
                  </select>
                </div>
                <div>
                  <label for="activityData" class="block text-sm font-medium text-gray-700">Data</label>
                  <input id="activityData" type="date" required
                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
                </div>
                <div style="display:none">
                  <label for="activityDataFine" class="block text-sm font-medium text-gray-700">Data Fine
                    (Opzionale)</label>
                  <input id="activityDataFine" type="date"
                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
                </div>
                <div>
                  <label for="activityDescrizione" class="block text-sm font-medium text-gray-700">Descrizione</label>
                  <input id="activityDescrizione" required
                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
                </div>
                <div>
                  <label for="activityCosto" class="block text-sm font-medium text-gray-700">Costo (‚Ç¨)</label>
                  <input id="activityCosto" type="number" min="0" step="0.01" placeholder="0"
                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
                </div>
                <button class="btn-primary w-full">Crea Attivit√†</button>
              </form>
            </div>

            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
              <h3 class="text-xl font-semibold text-gray-700 mb-4">Prossime Attivit√†</h3>
              <div id="calendarList" class="space-y-2"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Modale Modifica Attivit√† -->
    <div id="editActivityModal"
      class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
      <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
          <h3 class="text-lg font-semibold text-gray-800">Modifica Attivit√†</h3>
          <button onclick="UI.closeModal('editActivityModal')" class="text-gray-500 hover:text-gray-700">‚úï</button>
        </div>
        <div class="p-6">
          <form id="editActivityForm" class="space-y-4">
            <input type="hidden" id="editActivityId">
            <div>
              <label for="editActivityTipo" class="block text-sm font-medium text-gray-700">Tipo</label>
              <select id="editActivityTipo" required
                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200">
                <option value="Riunione">Riunione</option>
                <option value="Attivit√† lunga">Attivit√† lunga</option>
                <option value="Uscita">Uscita</option>
                <option value="Campo">Campo</option>
                <option value="Evento Adulti">Evento Adulti</option>
                <option value="Riunione Adulti">Riunione Adulti</option>
                <option value="Eventi con esterni">Eventi con esterni</option>
              </select>
            </div>
            <div>
              <label for="editActivityData" class="block text-sm font-medium text-gray-700">Data</label>
              <input id="editActivityData" type="date" required
                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div style="display:none">
              <label for="editActivityDataFine" class="block text-sm font-medium text-gray-700">Data Fine
                (Opzionale)</label>
              <input id="editActivityDataFine" type="date"
                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="editActivityDescrizione" class="block text-sm font-medium text-gray-700">Descrizione</label>
              <input id="editActivityDescrizione" required
                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="editActivityCosto" class="block text-sm font-medium text-gray-700">Costo (‚Ç¨)</label>
              <input id="editActivityCosto" type="number" min="0" step="0.01"
                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div class="flex justify-end gap-3 mt-6">
              <button type="button" onclick="UI.closeModal('editActivityModal')"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Annulla</button>
              <button type="submit"
                class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700">Salva
                Modifiche</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modale Conferma Eliminazione -->
    <div id="confirmDeleteActivityModal"
      class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
      <div class="bg-white rounded-lg shadow-lg w-full max-w-sm mx-4 overflow-hidden">
        <div class="p-6 text-center">
          <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
            <span class="text-2xl">üóëÔ∏è</span>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">Elimina attivit√†?</h3>
          <p class="text-sm text-gray-500 mb-6">
            Sei sicuro di voler eliminare <span id="activityInfoToDelete" class="font-semibold">questa attivit√†</span>?
            L'azione non pu√≤ essere annullata.
          </p>
          <div class="flex justify-center gap-3">
            <button onclick="UI.closeModal('confirmDeleteActivityModal')"
              class="px-4 py-2 text-base font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 w-full">
              Annulla
            </button>
            <button id="confirmDeleteActivityBtn"
              class="px-4 py-2 text-base font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 w-full">
              Elimina
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <!-- Configurazione Firebase (generata durante il build) -->
  <script src="/config.js"></script>
  <script type="module" src="shared.js"></script>
  <script type="module" src="calendario.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(reg => console.log("Service Worker registrato:", reg.scope))
        .catch(err => console.error("SW registration failed:", err));
    }
  </script>
</body>

</html>